<!DOCTYPE html>
<html lang="en">

<head>
    <title>All Administrators - MediTrack</title>
    <%- include('../../partials/_header') %>
    <%- include('../../partials/_styles') %>
</head>

<body>
    <%- include('../../partials/_sidebar') %>
    <%- include('../../partials/_auth') %>

    <div class="main-content">
    </div>

    <%- include('../../partials/_scripts') %>
</body>

</html>

<div class="form-container">
    <div class="header-container">
        <h1>All Administrators</h1>
        <button class="add-admin-btn" onclick="window.location.href='/add-admin'">Add Admin</button>
    </div>
</div>

<% if (typeof error !== 'undefined' && error) { %>
    <p class="error-message"><%= error %></p>
    <% } %>
    
    <table class="admins-table" id="adminsTable">
        <thead>
            <tr>
                <th onclick="sortTable(0)">Name</th>
                <th onclick="sortTable(1)">Email</th>
                <th onclick="sortTable(2)">Phone</th>
                <th onclick="sortTable(3)">Organization ID</th>
                <th onclick="sortTable(4)">Created At</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody id="adminsBody">
        </tbody>
    </table>
    

    <% if (admins && admins.length > 0) { %>
        <% admins.forEach(admin => { %>
            <tr data-id="<%= admin.userId %>">
                <td><input type="text" id="name-<%= admin.userId %>" value="<%= admin.name %>" disabled required /></td>
                <td><input type="email" id="email-<%= admin.userId %>" value="<%= admin.email %>" disabled required /></td>
                <td><input type="tel" id="phone-<%= admin.userId %>" value="<%= admin.phone %>" disabled required /></td>
                <td><input type="text" id="organizationId-<%= admin.userId %>" value="<%= admin.organizationId %>" disabled required /></td>
                <td><input type="datetime-local" id="createdAt-<%= admin.userId %>" value="<%= admin.createdAt ? admin.createdAt.slice(0,16) : '' %>" disabled /></td>
                <td>
                    <button class="edit-btn" data-id="<%= admin.userId %>">Edit</button>
                    <button class="save-btn" data-id="<%= admin.userId %>" style="display: none;">Save</button>
                    <button class="delete-btn" data-id="<%= admin.userId %>">Delete</button>
                </td>
            </tr>
        <% }) %>
    <% } else { %>
        <tr>
            <td colspan="6" style="text-align: center;">No administrators found.</td>
        </tr>
    <% } %>
    

    <script>
        let adminsData = <% - JSON.stringify(admins || []) %>;
        let sortColumn = -1;
        let sortDirection = 1;
    
        function sortTable(columnIndex) {
            if (sortColumn === columnIndex) {
                sortDirection *= -1;
            } else {
                sortDirection = 1;
            }
            sortColumn = columnIndex;
    
            adminsData.sort((a, b) => {
                let aValue = a[columnIndex] || '';
                let bValue = b[columnIndex] || '';
    
                if (aValue < bValue) return -1 * sortDirection;
                if (aValue > bValue) return 1 * sortDirection;
                return 0;
            });
    
            renderTable();
            updateSortIndicators(columnIndex);
        }
    </script>
    
    <script>
        function attachEventListeners() {
            document.querySelectorAll('.edit-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const id = e.target.dataset.id;
                    const row = e.target.closest('tr');
                    const inputs = row.querySelectorAll('input');
                    const saveBtn = row.querySelector('.save-btn');
                    inputs.forEach(input => input.disabled = false);
                    e.target.style.display = 'none';
                    saveBtn.style.display = 'inline-block';
                });
            });
        }
    </script>
    